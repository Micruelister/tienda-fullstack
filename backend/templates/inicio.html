<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Tienda Online</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos.css') }}">
</head>
<body>
<header>
    <h1>¡Bienvenido a Mi Tienda Online!</h1>
    <nav>
        <a href="{{ url_for('ver_carrito') }}">Ver Carrito</a>
        
        <!-- Lógica para mostrar enlaces dependiendo de si el usuario ha iniciado sesión -->
        {% if 'user_id' in session %}
            <a href="{{ url_for('mi_cuenta') }}">Mi Cuenta</a>

            <!-- Comprobamos si el usuario es un administrador -->
            {% if session.get('is_admin') %}
                <a href="{{ url_for('gestionar_inventario') }}">Gestionar Inventario</a>
            {% endif %}

            <a href="{{ url_for('logout') }}">Cerrar Sesión</a>
        {% else %}
            <a href="{{ url_for('login') }}">Iniciar Sesión</a>
            <a href="{{ url_for('registro') }}">Crear Cuenta</a>
        {% endif %}
        
    </nav>
</header>

<main>
    <!-- Bloque para mostrar los mensajes Flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <h2>Productos Destacados</h2>
    <div class="contenedor-productos">
        {% for producto in productos %}
            <div class="producto-card">
                {% if producto.imagen %}
                    <img src="{{ url_for('static', filename='uploads/products/' + producto.imagen) }}" alt="{{ producto.nombre }}" style="max-width: 100%; height: auto;">
                {% endif %}
                <h3>
                    <a href="{{ url_for('detalle_producto', producto_id=producto.id) }}">{{ producto.nombre }}</a>
                </h3>
                <p>Precio: ${{ producto.precio }}</p>
                
                <form action="{{ url_for('añadir_al_carrito', producto_id=producto.id) }}" method="POST">
                    <button type="submit">Añadir al Carrito</button>
                </form>
            </div>
        {% endfor %}
    </div>
</main>

<footer>
    <p>&copy; 2025 Mi Tienda Online. Todos los derechos reservados.</p>
</footer>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>